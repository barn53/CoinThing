<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
        crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/bootstrap-slider.min.js"
        integrity="sha512-f0VlzJbcEB6KiW8ZVtL+5HWPDyW1+nJEjguZ5IVnSQkvZbwBt2RfCBY0CBO1PsMAqxxrG4Di6TfsCPP3ZRwKpA=="
        crossorigin="anonymous"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/css/bootstrap-slider.min.css"
        integrity="sha512-3q8fi8M0VS+X/3n64Ndpp6Bit7oXSiyCnzmlx6IDBLGlY5euFySyJ46RUlqIVs0DPCGOypqP8IRk/EyPvU28mQ=="
        crossorigin="anonymous" />
    <link rel="stylesheet" href="style.css">
    <title>CoinThing 2" Settings</title>
</head>

<body>

    <div class="jumbotron xxjumbotron-fluid">
        <div class="container">
            <h1>CoinThing 2"</h1>
            <p class="lead">Settings</p>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="error_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title " id="error_modalLabel">Error occurred</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body text-danger">
                    <span id="error_text"></span>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid text-center">
        <div class="row content">
            <div class="col-sm-2 sidenav">
            </div>
            <div class="col-sm-7 text-left">
                <nav>
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <a class="nav-link active" id="nav-1-tab" data-toggle="tab" href="#nav-1" role="tab"
                            aria-controls="nav-1" aria-selected="true">One Coin</a>
                        <a class="nav-link" id="nav-2-tab" data-toggle="tab" href="#nav-2" role="tab"
                            aria-controls="nav-2" aria-selected="true">Two Coins</a>
                        <a class="nav-link" id="nav-n-tab" data-toggle="tab" href="#nav-n" role="tab"
                            aria-controls="nav-n" aria-selected="false">Multiple Coins</a>
                    </div>
                </nav>
                <form class="tab-content" id="nav-tabContent">
                    <p> </p>
                    <div class="tab-pane fade show active" id="nav-1" role="tabpanel" aria-labelledby="nav-1-tab">
                        <div class="form-group">
                            <div><label for="coin0"><b>Coin ID or symbol (e.g. bitcoin, btc)</b></label></div>
                            <div class="input-group" style="width:100%;">
                                <input type="text" class="form-control enterapply sync sync_coin0" id="coin0"
                                    placeholder="Coin" autofocus>
                                <div class="input-group-append">
                                    <span id="coin0clear" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div><label for="currency0"><b>Currencies (e.g. USD, EUR)</b></label></div>
                            <div class="input-group">
                                <input type="text" class="form-control enterapply sync sync_currency0" id="currency0"
                                    placeholder="Currency">
                                <div class="input-group-append">
                                    <span id="currency0clear" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="text" class="form-control enterapply sync sync_currency1" id="currency1"
                                    placeholder="2nd Currency">
                                <div class="input-group-append">
                                    <span id="currency1clear" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><b>Chart Period</b></label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="cp" id="cp_1" value="1">
                                    <label class="form-check-label" for="cp_1">24 h</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="cp" id="cp_2" value="2">
                                    <label class="form-check-label" for="cp_2">48 h</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="cp" id="cp_4" value="4">
                                    <label class="form-check-label" for="cp_4">30 d</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="cp" id="cp_8" value="8">
                                    <label class="form-check-label" for="cp_8">60 d</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><b>Chart Swap Interval</b></label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="si" id="si_0" value="0">
                                    <label class="form-check-label" for="si_0">5 sec</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="si" id="si_1" value="1">
                                    <label class="form-check-label" for="si_1">30 sec</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="si" id="si_2" value="2">
                                    <label class="form-check-label" for="si_2">1 min</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="si" id="si_3" value="3">
                                    <label class="form-check-label" for="si_3">5 min</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><b>Chart Style</b></label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cs" id="cs_0" value="0">
                                    <label class="form-check-label" for="cs_0">Simple</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cs" id="cs_1" value="1">
                                    <label class="form-check-label" for="cs_1">High Low</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cs" id="cs_2" value="2">
                                    <label class="form-check-label" for="cs_2">High Low First Last</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="nav-2" role="tabpanel" aria-labelledby="nav-2-tab">
                        <div class="form-group">
                            <div><label for="coin0-2"><b>Coin IDs or symbols (e.g. bitcoin, btc)</b></label></div>
                            <div class="input-group">
                                <input type="text" class="form-control enterapply sync sync_coin0" id="coin0-2"
                                    placeholder="1st Coin">
                                <div class="input-group-append">
                                    <span id="coin0clear-2" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="text" class="form-control enterapply sync sync_coin1" id="coin1-2"
                                    placeholder="2nd Coin">
                                <div class="input-group-append">
                                    <span id="coin1clear-2" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div><label for="currency0-2"><b>Currencies (e.g. USD, EUR)</b></label></div>
                            <div class="input-group">
                                <input type="text" class="form-control enterapply sync sync_currency0" id="currency0-2"
                                    placeholder="Currency">
                                <div class="input-group-append">
                                    <span id="currency0clear-2" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="text" class="form-control enterapply sync sync_currency1" id="currency1-2"
                                    placeholder="2nd Currency">
                                <div class="input-group-append">
                                    <span id="currency1clear-2" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="nav-n" role="tabpanel" aria-labelledby="nav-n-tab">
                        <div class="form-group">
                            <div><label for="coin0-n"><b>Coin IDs or symbols (e.g. bitcoin, btc)</b></label></div>
                            <div class="input-group">
                                <input type="text" class="form-control enterapply sync sync_coin0" id="coin0-n"
                                    placeholder="1st Coin">
                                <div class="input-group-append">
                                    <span id="coin0clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="text" class="form-control enterapply sync sync_coin1" id="coin1-n"
                                    placeholder="2nd Coin">
                                <div class="input-group-append">
                                    <span id="coin1clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>

                            <div class="input-group">
                                <input type="text" class="form-control enterapply" id="coin2-n" placeholder="3rdCoin">
                                <div class="input-group-append">
                                    <span id="coin2clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="text" class="form-control enterapply" id="coin3-n" placeholder="4th Coin">
                                <div class="input-group-append">
                                    <span id="coin3clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>

                            <div class="input-group">
                                <input type="text" class="form-control enterapply" id="coin4-n" placeholder="5th Coin">
                                <div class="input-group-append">
                                    <span id="coin4clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="text" class="form-control enterapply" id="coin5-n" placeholder="6th Coin">
                                <div class="input-group-append">
                                    <span id="coin5clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>

                            <div class="input-group">
                                <input type="text" class="form-control enterapply" id="coin6-n" placeholder="7th Coin">
                                <div class="input-group-append">
                                    <span id="coin6clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="text" class="form-control enterapply" id="coin7-n" placeholder="8th Coin">
                                <div class="input-group-append">
                                    <span id="coin7clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>

                            <div class="input-group">
                                <input type="text" class="form-control enterapply" id="coin8-n" placeholder="9th Coin">
                                <div class="input-group-append">
                                    <span id="coin8clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="text" class="form-control enterapply" id="coin9-n" placeholder="10th Coin">
                                <div class="input-group-append">
                                    <span id="coin9clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <button type="button" class="btn btn-info btn-sm" id="trending">Get Trending</button>
                            <button type="button" class="btn btn-info btn-sm" id="top10">Get Top 10</button>
                        </div>

                        <div class="form-group">
                            <div><label for="currency0-n"><b>Currencies (e.g. USD, EUR)</b></label></div>
                            <div class="input-group">
                                <input type="text" class="form-control enterapply sync sync_currency0" id="currency0-n"
                                    placeholder="Currency">
                                <div class="input-group-append">
                                    <span id="currency0clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="text" class="form-control enterapply sync sync_currency1" id="currency1-n"
                                    placeholder="2nd Currency">
                                <div class="input-group-append">
                                    <span id="currency1clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><b>Coin Swap Interval</b></label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="si-n" id="si_0-n" value="0">
                                    <label class="form-check-label" for="si_0-n">10 sec</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="si-n" id="si_1-n" value="1">
                                    <label class="form-check-label" for="si_1-n">30 sec</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="si-n" id="si_2-n" value="2">
                                    <label class="form-check-label" for="si_2-n">1 min</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="si-n" id="si_3-n" value="3">
                                    <label class="form-check-label" for="si_3-n">5 min</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><b>Chart Period</b></label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cp-n" id="cp_1-n" value="1">
                                    <label class="form-check-label" for="cp_1-n">24 h</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cp-n" id="cp_2-n" value="2">
                                    <label class="form-check-label" for="cp_2-n">48 h</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cp-n" id="cp_4-n" value="4">
                                    <label class="form-check-label" for="cp_4-n">30 d</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cp-n" id="cp_8-n" value="8">
                                    <label class="form-check-label" for="cp_8-n">60 d</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><b>Chart Style</b></label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cs-n" id="cs_0-n" value="0">
                                    <label class="form-check-label" for="cs_0-n">Simple</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cs-n" id="cs_1-n" value="1">
                                    <label class="form-check-label" for="cs_1-n">High Low</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cs-n" id="cs_2-n" value="2">
                                    <label class="form-check-label" for="cs_2-n">High Low First Last</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><b>Number Format</b></label>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="nf" id="nf_0" value="0">
                                <label class="form-check-label" for="nf_0">1.000,00</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="nf" id="nf_1" value="1">
                                <label class="form-check-label" for="nf_1">1&#x2006;000,00</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="nf" id="nf_2" value="2">
                                <label class="form-check-label" for="nf_2">1000,00</label>
                            </div>
                        </div>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="nf" id="nf_3" value="3">
                                <label class="form-check-label" for="nf_3">1,000.00</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="nf" id="nf_4" value="4">
                                <label class="form-check-label" for="nf_4">1&#x2006;000.00</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="nf" id="nf_5" value="5">
                                <label class="form-check-label" for="nf_5">1000.00</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><b>Heartbeat</b></label>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="heartbeat" value="hb">
                                <label class="form-check-label" for="heartbeat">Heartbeat</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <button type="button" class="btn btn-success mb-2" id="apply">Apply&nbsp;&nbsp;
                            <i class="fa fa-spinner fa-spin" id="applyspinner" style="visibility:hidden;"></i></button>
                        <span id="coingeckoready" style="font-size:0.7em;"><br>Contacting CoinGecko&nbsp;<span
                                class="fa fa-spinner fa-spin"></span></span>
                    </div>

                    <hr>
                    <div class="form-group">
                        <label><b>Display Bightness</b></label>
                        <div>
                            <input id="brightness" type="text" />
                        </div>
                    </div>

                </form>
                <div class="row content" style="height:50px;">
                </div>
            </div>
            <div class="col-sm-3 sidenav">
            </div>
        </div>
    </div>

    <footer class="footer bg-dark text-light ">
        <div class="container">
            &copy; 2022 barn53 &mdash; <a href="about.html">About</a>
        </div>
    </footer>

    <script type="text/javascript">

        var brightnessSlider

        function applyBusy(busy) {
            if (busy) {
                $("#apply").prop("disabled", true)
                $("#applyspinner").css("visibility", "visible")
            } else {
                $("#applyspinner").css("visibility", "hidden")
                setTimeout(() => {
                    // to avoid too fast clicks
                    $("#apply").prop("disabled", false)
                }, 500);
            }
        }

        function displayBrightness(brightness) {
            brightnessSlider.slider("setValue", brightness['b'])
            console.log(JSON.stringify(brightness))
        }

        function displaySettings(settings) {
            applyBusy(false)

            if (settings.mode == 1) {
                $('#nav-tab a[href="#nav-1"]').tab('show')

                $("#coin0").valEvent(settings.coins[0].name || '')
                $("#currency0").valEvent(settings.currencies[0].currency || '')
                $("#currency1").valEvent(settings.currencies[1].currency || '')
                chart_period = settings.chart_period || 0
                swap_interval = settings.swap_interval || 0
                chart_style = settings.chart_style || 0

                if ((chart_period & 1) > 0) {
                    $("#cp_1")[0].checked = true
                }
                if ((chart_period & 2) > 0) {
                    $("#cp_2")[0].checked = true
                }
                if ((chart_period & 4) > 0) {
                    $("#cp_4")[0].checked = true
                }
                if ((chart_period & 8) > 0) {
                    $("#cp_8")[0].checked = true
                }

                try {
                    $("#si_" + swap_interval)[0].checked = true
                } catch (error) { }

                try {
                    $("#cs_" + chart_style)[0].checked = true
                } catch (error) { }

            } else if (settings.mode == 2) {
                $('#nav-tab a[href="#nav-2"]').tab('show')

                $("#coin0-2").valEvent(settings.coins[0].name || '')
                $("#coin1-2").valEvent(settings.coins[1].name || '')
                $("#currency0-2").valEvent(settings.currencies[0].currency || '')
                $("#currency1-2").valEvent(settings.currencies[1].currency || '')
            } else if (settings.mode == 3) {
                $('#nav-tab a[href="#nav-n"]').tab('show')


                for (ii = 0; ii < 10; ++ii) {
                    if (ii < settings.coins.length) {
                        $("#coin" + ii + "-n").valEvent(settings.coins[ii].name || '')
                    } else {
                        $("#coin" + ii + "-n").val('')
                    }
                }

                $("#currency0-n").valEvent(settings.currencies[0].currency || '')
                $("#currency1-n").valEvent(settings.currencies[1].currency || '')
                swap_interval = settings.swap_interval || 0
                chart_period = settings.chart_period || 0
                chart_style = settings.chart_style || 0

                try {
                    $("#si_" + swap_interval + "-n")[0].checked = true
                } catch (error) { }

                try {
                    $("#cp_" + chart_period + "-n")[0].checked = true
                } catch (error) { }

                try {
                    $("#cs_" + chart_style + "-n")[0].checked = true
                } catch (error) { }
            }

            number_format = settings.number_format || 0
            heartbeat = settings.heartbeat || 0

            try {
                $("#nf_" + number_format)[0].checked = true
            } catch (error) { }

            $("#heartbeat")[0].checked = (heartbeat !== 0)

            console.log(JSON.stringify(settings))
        }

        function getSettings() {
            $.get("/settings.json", function (data) {
                displaySettings(data)
            })
        }

        function getBrightness() {
            $.get("/brightness.json", function (data) {
                displayBrightness(data)
            }).fail(() => {
                displayBrightness({ "b": 255 })
            })
        }

        function showError(text) {
            $("#error_text").empty().append("Error " + text)
            $('#error_modal').modal({})
            applyBusy(false)
        }

        function checkFailed(e) {
            showError(e.responseText)
        }

        // https://stackoverflow.com/questions/3446170/escape-string-for-use-in-javascript-regex
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // $& means the whole matched string
        }

        function checkCoin(coin, allowEmpty) {
            if (allowEmpty && coin === '') {
                return true
            }

            var re = new RegExp('^' + escapeRegExp(coin) + '$', "i")
            myCoin = allCoins.find(function (c) {
                if (c.id.match(re)
                    || c.symbol.match(re)
                    || c.name.match(re)) {
                    return true
                }
                return false
            })
            if (myCoin) {
                return true
            }
            showError(": Coin '" + coin + "' is invalid!")
            return false
        }

        function getCoinInfo(coin) {
            var re = new RegExp('^' + escapeRegExp(coin) + '$', "i")
            myCoin = allCoins.find(function (c) {
                if (c.id.match(re)
                    || c.symbol.match(re)
                    || c.name.match(re)) {
                    return true
                }
                return false
            })
            if (myCoin) {
                myCoin.symbol = myCoin.symbol.toUpperCase()
            }
            return myCoin
        }

        function checkCurrency(currency, allowEmpty) {
            if (allowEmpty && currency === '') {
                return true
            }

            var re = new RegExp('^' + escapeRegExp(currency) + '$', "i")
            myCurrency = allCurrencies.find(function (c) {
                if (c.currency.match(re)) {
                    return true
                }
                return false
            })
            if (myCurrency) {
                return true
            }
            showError(": Currency value '" + currency + "' is invalid!")
            return false
        }

        function getCurrencyInfo(currency, allowEmpty) {
            if (allowEmpty && currency === '') {
                return { "currency": "USD", "symbol": "$" }
            }

            var re = new RegExp('^' + escapeRegExp(currency) + '$', "i")
            myCurrency = allCurrencies.find(function (c) {
                if (c.currency.match(re)) {
                    return true
                }
                return false
            })
            return myCurrency
        }

        function trimAll() {
            $("#coin0").val($("#coin0").val().trim())

            $("#coin0-2").val($("#coin0-2").val().trim())
            $("#coin1-2").val($("#coin1-2").val().trim())

            $("#coin0-n").val($("#coin0-n").val().trim())
            $("#coin1-n").val($("#coin1-n").val().trim())
            $("#coin2-n").val($("#coin2-n").val().trim())
            $("#coin3-n").val($("#coin3-n").val().trim())
            $("#coin4-n").val($("#coin4-n").val().trim())
            $("#coin5-n").val($("#coin5-n").val().trim())
            $("#coin6-n").val($("#coin6-n").val().trim())
            $("#coin7-n").val($("#coin7-n").val().trim())
            $("#coin8-n").val($("#coin8-n").val().trim())
            $("#coin9-n").val($("#coin9-n").val().trim())

            $("#currency0").val($("#currency0").val().trim())
            $("#currency1").val($("#currency1").val().trim())

            $("#currency0-2").val($("#currency0-2").val().trim())
            $("#currency1-2").val($("#currency1-2").val().trim())

            $("#currency0-n").val($("#currency0-n").val().trim())
            $("#currency1-n").val($("#currency1-n").val().trim())
        }

        function clickApply() {
            applyBusy(true)
            trimAll()
            settings = {}

            if ($("#nav-1").hasClass('active')) {
                settings.mode = 1

                if (!checkCoin($("#coin0").val())
                    || !checkCurrency($("#currency0").val(), false)
                    || !checkCurrency($("#currency1").val(), true)) {
                    return
                }

                settings.coins = [getCoinInfo($("#coin0").val())]

                settings.currencies = [
                    getCurrencyInfo($("#currency0").val(), false),
                    getCurrencyInfo($("#currency1").val(), true)
                ]

                settings.chart_period = 0
                if ($("#cp_1")[0].checked) {
                    settings.chart_period += 1
                }
                if ($("#cp_2")[0].checked) {
                    settings.chart_period += 2
                }
                if ($("#cp_4")[0].checked) {
                    settings.chart_period += 4
                }
                if ($("#cp_8")[0].checked) {
                    settings.chart_period += 8
                }
                if (settings.chart_period === 0) {
                    showError(": No chart period selected!")
                    return
                }

                settings.swap_interval = -1
                if ($("#si_0")[0].checked) {
                    settings.swap_interval = 0
                } else if ($("#si_1")[0].checked) {
                    settings.swap_interval = 1
                } else if ($("#si_2")[0].checked) {
                    settings.swap_interval = 2
                } else if ($("#si_3")[0].checked) {
                    settings.swap_interval = 3
                }
                if (settings.swap_interval === -1) {
                    showError(": No chart swap interval selected!")
                    return
                }

                settings.chart_style = -1
                if ($("#cs_0")[0].checked) {
                    settings.chart_style = 0
                } else if ($("#cs_1")[0].checked) {
                    settings.chart_style = 1
                } else if ($("#cs_2")[0].checked) {
                    settings.chart_style = 2
                }
                if (settings.chart_style === -1) {
                    showError(": No chart style selected!")
                    return
                }
            }
            if ($("#nav-2").hasClass('active')) {
                settings.mode = 2

                if (!checkCoin($("#coin0-2").val())
                    || !checkCoin($("#coin1-2").val())
                    || !checkCurrency($("#currency0-2").val(), false)
                    || !checkCurrency($("#currency1-2").val(), true)) {
                    return
                }

                settings.coins = [
                    getCoinInfo($("#coin0-2").val()),
                    getCoinInfo($("#coin1-2").val())
                ]
                settings.currencies = [
                    getCurrencyInfo($("#currency0-2").val(), false),
                    getCurrencyInfo($("#currency1-2").val(), true)
                ]
            }

            if ($("#nav-n").hasClass('active')) {
                settings.mode = 3

                if (!checkCoin($("#coin0-n").val())
                    || !checkCoin($("#coin1-n").val(), true)
                    || !checkCoin($("#coin2-n").val(), true)
                    || !checkCoin($("#coin3-n").val(), true)
                    || !checkCoin($("#coin4-n").val(), true)
                    || !checkCoin($("#coin5-n").val(), true)
                    || !checkCoin($("#coin6-n").val(), true)
                    || !checkCoin($("#coin7-n").val(), true)
                    || !checkCoin($("#coin8-n").val(), true)
                    || !checkCoin($("#coin9-n").val(), true)
                    || !checkCurrency($("#currency0-n").val(), false)
                    || !checkCurrency($("#currency1-n").val(), true)) {
                    return
                }

                settings.coins = []
                if ($("#coin0-n").val().length > 0) settings.coins.push(getCoinInfo($("#coin0-n").val()))
                if ($("#coin1-n").val().length > 0) settings.coins.push(getCoinInfo($("#coin1-n").val()))
                if ($("#coin2-n").val().length > 0) settings.coins.push(getCoinInfo($("#coin2-n").val()))
                if ($("#coin3-n").val().length > 0) settings.coins.push(getCoinInfo($("#coin3-n").val()))
                if ($("#coin4-n").val().length > 0) settings.coins.push(getCoinInfo($("#coin4-n").val()))
                if ($("#coin5-n").val().length > 0) settings.coins.push(getCoinInfo($("#coin5-n").val()))
                if ($("#coin6-n").val().length > 0) settings.coins.push(getCoinInfo($("#coin6-n").val()))
                if ($("#coin7-n").val().length > 0) settings.coins.push(getCoinInfo($("#coin7-n").val()))
                if ($("#coin8-n").val().length > 0) settings.coins.push(getCoinInfo($("#coin8-n").val()))
                if ($("#coin9-n").val().length > 0) settings.coins.push(getCoinInfo($("#coin9-n").val()))

                settings.currencies = [
                    getCurrencyInfo($("#currency0-n").val(), false),
                    getCurrencyInfo($("#currency1-n").val(), true)
                ]

                settings.swap_interval = -1
                if ($("#si_0-n")[0].checked) {
                    settings.swap_interval = 0
                } else if ($("#si_1-n")[0].checked) {
                    settings.swap_interval = 1
                } else if ($("#si_2-n")[0].checked) {
                    settings.swap_interval = 2
                } else if ($("#si_3-n")[0].checked) {
                    settings.swap_interval = 3
                }
                if (settings.swap_interval === -1) {
                    showError(": No coin swap interval selected!")
                    return
                }

                settings.chart_period = 0
                if ($("#cp_1-n")[0].checked) {
                    settings.chart_period = 1
                } else if ($("#cp_2-n")[0].checked) {
                    settings.chart_period = 2
                } else if ($("#cp_4-n")[0].checked) {
                    settings.chart_period = 4
                } else if ($("#cp_8-n")[0].checked) {
                    settings.chart_period = 8
                }
                if (settings.chart_period === 0) {
                    showError(": No chart period selected!")
                    return
                }

                settings.chart_style = -1
                if ($("#cs_0-n")[0].checked) {
                    settings.chart_style = 0
                } else if ($("#cs_1-n")[0].checked) {
                    settings.chart_style = 1
                } else if ($("#cs_2-n")[0].checked) {
                    settings.chart_style = 2
                }
                if (settings.chart_style === -1) {
                    showError(": No chart style selected!")
                    return
                }
            }

            settings.number_format = -1
            if ($("#nf_0")[0].checked) {
                settings.number_format = 0
            } else if ($("#nf_1")[0].checked) {
                settings.number_format = 1
            } else if ($("#nf_2")[0].checked) {
                settings.number_format = 2
            } else if ($("#nf_3")[0].checked) {
                settings.number_format = 3
            } else if ($("#nf_4")[0].checked) {
                settings.number_format = 4
            } else if ($("#nf_5")[0].checked) {
                settings.number_format = 5
            }
            if (settings.number_format === -1) {
                showError(": Number format not selected!")
                return
            }

            settings.heartbeat = false
            if ($("#heartbeat")[0].checked) {
                settings.heartbeat = true
            }

            $.get("/action/set?json=" + JSON.stringify(settings), function (data) {
                if (data["error"]) {
                    showError(": " + data["error"])
                } else {
                    displaySettings(data)
                }
            }).fail(checkFailed)
                .always(function () {
                    setTimeout(function () {
                        applyBusy(false)
                    }, 10000)
                })
        }

        let allCoins
        function getAllCoins() {
            $.get("https://api.coingecko.com/api/v3/coins/list?include_platform=false", function (data) {
                allCoins = data
                allCoins.sort(function (a, b) { return a.name.length - b.name.length })
                $("#coingeckoready").css("display", "none")
            }).fail((jqXHR) => {
                setTimeout(() => {
                    getAllCoins()
                }, 10000)
            })
        }

        let allCurrencies = [
            { "currency": "USD", "symbol": "$" }, // US Dollar
            { "currency": "EUR", "symbol": "€" }, // Euro
            { "currency": "BTC", "symbol": "₿" }, // Bitcoin - U+20BF
            { "currency": "ETH", "symbol": "Ξ" }, // Ethereum - Greek Capital Letter Xi - U+039E
            { "currency": "LTC", "symbol": "Ł" }, // Latin Capital Letter L with Stroke - U+141
            { "currency": "BCH", "symbol": "BCH" }, // Bitcoin Cash
            { "currency": "BNB", "symbol": "BNB" }, // Binance Coin
            { "currency": "EOS", "symbol": "EOS" }, // EOS
            { "currency": "XRP", "symbol": "XRP" }, // Ripple
            { "currency": "XLM", "symbol": "XLM" }, // Stellar
            { "currency": "LINK", "symbol": "LINK" }, // Chainlink
            { "currency": "DOT", "symbol": "DOT" }, // Polkadot
            { "currency": "YFI", "symbol": "YFI" }, // Yearn.finance
            { "currency": "AED", "symbol": "AED" }, // Emirati dirham - د.إ
            { "currency": "ARS", "symbol": "$" }, // Argentina Peso
            { "currency": "AUD", "symbol": "$" }, // Australia Dollar
            { "currency": "BDT", "symbol": "৳" }, // Bangladeshi taka - U+09F3 not in NotoSans
            { "currency": "BHD", "symbol": "BD" }, // Bahraini dinar - .د.ب
            { "currency": "BMD", "symbol": "$" }, // Bermuda Dollar
            { "currency": "BRL", "symbol": "R$" }, // Brazil Real
            { "currency": "CAD", "symbol": "$" }, // Canadian dollars
            { "currency": "CHF", "symbol": "CHF" }, // Swiss franc
            { "currency": "CLP", "symbol": "$" }, // Chilean peso
            { "currency": "CNY", "symbol": "¥" }, // Chinese yuan
            { "currency": "CZK", "symbol": "Kč" }, // Czech koruna
            { "currency": "DKK", "symbol": "kr" }, // Danish krone
            { "currency": "GBP", "symbol": "£" }, // Pounds Sterling
            { "currency": "HKD", "symbol": "$" }, // Hong Kong dollar
            { "currency": "HUF", "symbol": "ft" }, // Hungarian forint
            { "currency": "IDR", "symbol": "Rp" }, // Indonesian rupiah
            { "currency": "ILS", "symbol": "₪" }, // Israeli shekel - U+20aa
            { "currency": "INR", "symbol": "₹" }, // Indian rupee
            { "currency": "JPY", "symbol": "¥" }, // Japanese yen
            { "currency": "KRW", "symbol": "₩" }, // South Korean won
            { "currency": "KWD", "symbol": "KD" }, // Kuwaiti dinar -	د.ك
            { "currency": "LKR", "symbol": "Rs" }, // Sri Lankan rupee
            { "currency": "MMK", "symbol": "Ks" }, // Burmese kyat
            { "currency": "MXN", "symbol": "$" }, // Mexican peso
            { "currency": "MYR", "symbol": "RM" }, // Malaysian ringgit
            { "currency": "NGN", "symbol": "₦" }, // Nigerian naira
            { "currency": "NOK", "symbol": "kr" }, // Norwegian krone
            { "currency": "NZD", "symbol": "$" }, // New Zealand dollar
            { "currency": "PHP", "symbol": "₱" }, // Philippine peso
            { "currency": "PKR", "symbol": "Rs" }, // Pakistani rupee
            { "currency": "PLN", "symbol": "zł" }, // Polish zloty
            { "currency": "RUB", "symbol": "₽" }, // Russian ruble - U+20BD
            { "currency": "SAR", "symbol": "SAR" }, // Saudi Arabia Riyal - ر.س
            { "currency": "SEK", "symbol": "krx" }, // Sweden Krona
            { "currency": "SGD", "symbol": "$" }, // Singapore Dollar
            { "currency": "THB", "symbol": "฿" }, // Thailand Baht - U+0E3F not in NotoSans
            { "currency": "TRY", "symbol": "₺" }, // Turkey Lira
            { "currency": "TWD", "symbol": "$" }, // Taiwan New Dollar
            { "currency": "UAH", "symbol": "₴" }, // Ukraine Hryvnia
            { "currency": "VEF", "symbol": "Bs" }, // Venezuela Bolívar
            { "currency": "VND", "symbol": "₫" }, // Viet Nam Dong
            { "currency": "ZAR", "symbol": "R" }, // South Africa Rand
            { "currency": "XDR", "symbol": "XDR" }, // Special Drawing Right
            { "currency": "XAG", "symbol": "XAG" }, // ?
            { "currency": "XAU", "symbol": "XAU" } // Philadelphia Gold and Silver Index
        ]

        function setDefaults() {
            if ($("#currency0-n").val().length == 0) {
                $("#currency0-n").valEvent("EUR")
            }
            if ($("#currency1-n").val().length == 0) {
                $("#currency1-n").valEvent("USD")
            }

            try {
                $("#si_0-n")[0].checked = true
            } catch (error) { }

            try {
                $("#cp_4-n")[0].checked = true
            } catch (error) { }

            try {
                $("#cs_0-n")[0].checked = true
            } catch (error) { }

            try {
                $("#nf_1")[0].checked = true
            } catch (error) { }

            try {
                $("#nf_1")[0].checked = true
            } catch (error) { }

            $("#heartbeat")[0].checked = true
        }

        function loadTop10() {
            $.get("https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false", function (data) {
                index = 0
                data.forEach(element => {
                    $("#coin" + index + "-n").valEvent(element.name)
                    index++
                });
                setDefaults()
            })
        }

        function loadTrending() {
            $.get("https://api.coingecko.com/api/v3/search/trending", function (data) {
                for (index = 0; index < 10; ++index) {
                    $("#coin" + index + "-n").val("")
                }
                index = 0
                data.coins.forEach(element => {
                    $("#coin" + index + "-n").valEvent(element.item.id)
                    index++
                });
                setDefaults()
            })
        }

        $.fn.valEvent = function (v) {
            return this.val(v).trigger("input");
        }

        $(document).ready(function () {

            brightnessSlider = $("#brightness").slider({
                min: 10, max: 255, value: 255, step: 50, tooltip: 'hide'
            })

            getAllCoins()
            getSettings()
            getBrightness()

            brightnessSlider.on('change', function (e) {
                console.log(e.value.newValue)
                $.get("/action/set?brightness=" + e.value.newValue, function (data) {
                    console.log(data)
                })
            })

            $('#apply').click(clickApply)

            $("#top10").click(loadTop10)
            $("#trending").click(loadTrending)

            $(".enterapply").on('keyup', function (e) {
                if (event.keyCode === 13) {
                    event.preventDefault()
                    clickApply()
                }
            })

            $(".clearbutton").click(function (e) {
                clearId = '#' + e.target.id.replace('clear', '')
                $(clearId).valEvent('')
                $(clearId).focus()
            })

            $('.sync').on('input', (e) => {
                toChange = ''
                id = e.target.id
                if (e.target.id.match(/^coin0/)) {
                    toChange = '.sync_coin0'
                } else if (e.target.id.match(/^coin1/)) {
                    toChange = '.sync_coin1'
                } else if (e.target.id.match(/^currency0/)) {
                    toChange = '.sync_currency0'
                } else if (e.target.id.match(/^currency1/)) {
                    toChange = '.sync_currency1'
                }
                $(toChange).val($('#' + id).val())
            })

        })

    </script>
</body>

</html>
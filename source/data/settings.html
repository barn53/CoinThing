<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
        crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/bootstrap-slider.min.js"
        integrity="sha512-f0VlzJbcEB6KiW8ZVtL+5HWPDyW1+nJEjguZ5IVnSQkvZbwBt2RfCBY0CBO1PsMAqxxrG4Di6TfsCPP3ZRwKpA=="
        crossorigin="anonymous"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/css/bootstrap-slider.min.css"
        integrity="sha512-3q8fi8M0VS+X/3n64Ndpp6Bit7oXSiyCnzmlx6IDBLGlY5euFySyJ46RUlqIVs0DPCGOypqP8IRk/EyPvU28mQ=="
        crossorigin="anonymous" />
    <link rel="stylesheet" href="style.css">
    <title>CoinThing Settings</title>
</head>

<body>

    <div class="jumbotron xxjumbotron-fluid">
        <div class="container">
            <h1>CoinThing</h1>
            <p class="lead">Settings</p>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="error_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title " id="error_modalLabel">Error occurred</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body text-danger">
                    <span id="error_text"></span>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid text-center">
        <div class="row content">
            <div class="col-sm-2 sidenav">
            </div>
            <div class="col-sm-7 text-left">
                <nav>
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <a class="nav-link active" id="nav-1-tab" data-toggle="tab" href="#nav-1" role="tab"
                            aria-controls="nav-1" aria-selected="true">One Coin</a>
                        <a class="nav-link" id="nav-2-tab" data-toggle="tab" href="#nav-2" role="tab"
                            aria-controls="nav-2" aria-selected="true">Two Coins</a>
                        <a class="nav-link" id="nav-n-tab" data-toggle="tab" href="#nav-n" role="tab"
                            aria-controls="nav-n" aria-selected="false">Multiple Coins</a>
                    </div>
                </nav>
                <form class="tab-content" id="nav-tabContent">
                    <p> </p>
                    <div class="tab-pane fade show active" id="nav-1" role="tabpanel" aria-labelledby="nav-1-tab">
                        <div class="form-group">
                            <div><label for="coin"><b>Coin ID or symbol (e.g. bitcoin, btc)</b></label></div>
                            <div class="input-group" style="width:100%;">
                                <input type="email" class="form-control enterapply" id="coin"
                                    placeholder="Coin Gecko ID" autofocus>
                                <div class="input-group-append">
                                    <span id="coinclear" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div><label for="currency"><b>Currencies (e.g. USD, EUR)</b></label></div>
                            <div class="input-group">
                                <input type="email" class="form-control enterapply" id="currency"
                                    placeholder="Currency">
                                <div class="input-group-append">
                                    <span id="currencyclear" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="email" class="form-control enterapply" id="currency2"
                                    placeholder="2nd Currency">
                                <div class="input-group-append">
                                    <span id="currency2clear" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><b>Chart Period</b></label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="cp" id="cp_1" value="1">
                                    <label class="form-check-label" for="cp_1">24 h</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="cp" id="cp_2" value="2">
                                    <label class="form-check-label" for="cp_2">48 h</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="cp" id="cp_4" value="4">
                                    <label class="form-check-label" for="cp_4">30 d</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="cp" id="cp_8" value="8">
                                    <label class="form-check-label" for="cp_8">60 d</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><b>Chart Swap Interval</b></label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="csi" id="csi_0" value="0">
                                    <label class="form-check-label" for="csi_0">5 sec</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="csi" id="csi_1" value="1">
                                    <label class="form-check-label" for="csi_1">30 sec</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="csi" id="csi_2" value="2">
                                    <label class="form-check-label" for="csi_2">1 min</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="csi" id="csi_3" value="3">
                                    <label class="form-check-label" for="csi_3">5 min</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><b>Chart Style</b></label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cs" id="cs_0" value="0">
                                    <label class="form-check-label" for="cs_0">Simple</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cs" id="cs_1" value="1">
                                    <label class="form-check-label" for="cs_1">High Low</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cs" id="cs_2" value="2">
                                    <label class="form-check-label" for="cs_2">High Low First Last</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="nav-2" role="tabpanel" aria-labelledby="nav-2-tab">
                        <div class="form-group">
                            <div><label for="coin-2"><b>Coin IDs or symbols (e.g. bitcoin, btc)</b></label></div>
                            <div class="input-group">
                                <input type="email" class="form-control enterapply" id="coin-2"
                                    placeholder="Coin Gecko ID">
                                <div class="input-group-append">
                                    <span id="coinclear-2" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="email" class="form-control enterapply" id="coin2-2"
                                    placeholder="2nd Coin Gecko ID">
                                <div class="input-group-append">
                                    <span id="coin2clear-2" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div><label for="currency-2"><b>Currencies (e.g. USD, EUR)</b></label></div>
                            <div class="input-group">
                                <input type="email" class="form-control enterapply" id="currency-2"
                                    placeholder="Currency">
                                <div class="input-group-append">
                                    <span id="currencyclear-2" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="email" class="form-control enterapply" id="currency2-2"
                                    placeholder="2nd Currency">
                                <div class="input-group-append">
                                    <span id="currency2clear-2" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="nav-n" role="tabpanel" aria-labelledby="nav-n-tab">
                        <div class="form-group">
                            <div><label for="coin-n"><b>Coin IDs or symbols (e.g. bitcoin, btc)</b></label></div>
                            <div class="input-group">
                                <input type="email" class="form-control enterapply" id="coin-n"
                                    placeholder="1st Coin Gecko ID">
                                <div class="input-group-append">
                                    <span id="coinclear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="email" class="form-control enterapply" id="coin2-n"
                                    placeholder="2nd Coin Gecko ID">
                                <div class="input-group-append">
                                    <span id="coin2clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>

                            <div class="input-group">
                                <input type="email" class="form-control enterapply" id="coin3-n"
                                    placeholder="3rdCoin Gecko ID">
                                <div class="input-group-append">
                                    <span id="coin3clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="email" class="form-control enterapply" id="coin4-n"
                                    placeholder="4th Coin Gecko ID">
                                <div class="input-group-append">
                                    <span id="coin4clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>

                            <div class="input-group">
                                <input type="email" class="form-control enterapply" id="coin5-n"
                                    placeholder="5th Coin Gecko ID">
                                <div class="input-group-append">
                                    <span id="coin5clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="email" class="form-control enterapply" id="coin6-n"
                                    placeholder="6th Coin Gecko ID">
                                <div class="input-group-append">
                                    <span id="coin6clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>

                            <div class="input-group">
                                <input type="email" class="form-control enterapply" id="coin7-n"
                                    placeholder="7th Coin Gecko ID">
                                <div class="input-group-append">
                                    <span id="coin7clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="email" class="form-control enterapply" id="coin8-n"
                                    placeholder="8th Coin Gecko ID">
                                <div class="input-group-append">
                                    <span id="coin8clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>

                            <div class="input-group">
                                <input type="email" class="form-control enterapply" id="coin9-n"
                                    placeholder="9th Coin Gecko ID">
                                <div class="input-group-append">
                                    <span id="coin9clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="email" class="form-control enterapply" id="coin10-n"
                                    placeholder="10th Coin Gecko ID">
                                <div class="input-group-append">
                                    <span id="coin10clear-n" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div><label for="currency-3"><b>Currencies (e.g. USD, EUR)</b></label></div>
                            <div class="input-group">
                                <input type="email" class="form-control enterapply" id="currency-3"
                                    placeholder="Currency">
                                <div class="input-group-append">
                                    <span id="currencyclear-3" class="input-group-text clearbutton">&times;</span>
                                </div>
                                <input type="email" class="form-control enterapply" id="currency2-3"
                                    placeholder="2nd Currency">
                                <div class="input-group-append">
                                    <span id="currency2clear-3" class="input-group-text clearbutton">&times;</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><b>Coin Swap Interval</b></label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="csi-n" id="csi_0-n" value="0">
                                    <label class="form-check-label" for="csi_0-n">5 sec</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="csi-n" id="csi_1-n" value="1">
                                    <label class="form-check-label" for="csi_1-n">30 sec</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="csi-n" id="csi_2-n" value="2">
                                    <label class="form-check-label" for="csi_2-n">1 min</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="csi-n" id="csi_3-n" value="3">
                                    <label class="form-check-label" for="csi_3-n">5 min</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><b>Chart Period</b></label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cp-n" id="cp_1-n" value="1">
                                    <label class="form-check-label" for="cp_1-n">24 h</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cp-n" id="cp_2-n" value="2">
                                    <label class="form-check-label" for="cp_2-n">48 h</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cp-n" id="cp_4-n" value="4">
                                    <label class="form-check-label" for="cp_4-n">30 d</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cp-n" id="cp_8-n" value="8">
                                    <label class="form-check-label" for="cp_8-n">60 d</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><b>Chart Style</b></label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cs-n" id="cs_0-n" value="0">
                                    <label class="form-check-label" for="cs_0-n">Simple</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cs-n" id="cs_1-n" value="1">
                                    <label class="form-check-label" for="cs_1-n">High Low</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="cs-n" id="cs_2-n" value="2">
                                    <label class="form-check-label" for="cs_2-n">High Low First Last</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><b>Number Format</b></label>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="nf" id="nf_0" value="0">
                                <label class="form-check-label" for="nf_0">1.000,00</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="nf" id="nf_1" value="1">
                                <label class="form-check-label" for="nf_1">1&#x2006;000,00</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="nf" id="nf_2" value="2">
                                <label class="form-check-label" for="nf_2">1000,00</label>
                            </div>
                        </div>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="nf" id="nf_3" value="3">
                                <label class="form-check-label" for="nf_3">1,000.00</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="nf" id="nf_4" value="4">
                                <label class="form-check-label" for="nf_4">1&#x2006;000.00</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="nf" id="nf_5" value="5">
                                <label class="form-check-label" for="nf_5">1000.00</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><b>Heartbeat</b></label>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="heartbeat" value="hb">
                                <label class="form-check-label" for="heartbeat">Heartbeat</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <button type="button" class="btn btn-success mb-2" id="apply">Apply&nbsp;&nbsp;
                            <i class="fa fa-spinner fa-spin" id="applyspinner" style="visibility:hidden;"></i></button>
                    </div>

                    <hr>
                    <div class="form-group">
                        <label><b>Display Bightness</b></label>
                        <div>
                            <input id="brightness" type="text" />
                        </div>
                    </div>

                </form>
                <div class="row content" style="height:50px;">
                </div>
            </div>
            <div class="col-sm-3 sidenav">
            </div>
        </div>
    </div>

    <footer class="footer bg-dark text-light ">
        <div class="container">
            &copy; 2021 barn53 &mdash; <a href="about.html">About</a>
        </div>
    </footer>

    <script type="text/javascript">

        var brightnessSlider

        function applyBusy(busy) {
            if (busy) {
                $("#apply").prop("disabled", true)
                $("#applyspinner").css("visibility", "visible")
            } else {
                $("#apply").prop("disabled", false)
                $("#applyspinner").css("visibility", "hidden")
            }
        }

        function displaySettings(settings) {
            applyBusy(false)
            $("#coin").val(settings['coin'] || '')
            $("#currency").val(settings['currency'] || '')
            $("#currency2").val(settings['currency2'] || '')
            number_format = settings['number_format'] || 0
            chart_period = settings['chart_period'] || 0
            chart_swap_interval = settings['chart_swap_interval'] || 0
            chart_style = settings['chart_style'] || 0
            heartbeat = settings['heartbeat'] || 0

            try {
                $("#nf_" + number_format)[0].checked = true
            } catch (error) { }

            if ((chart_period & 1) > 0) {
                $("#cp_1")[0].checked = true
            }
            if ((chart_period & 2) > 0) {
                $("#cp_2")[0].checked = true
            }
            if ((chart_period & 4) > 0) {
                $("#cp_4")[0].checked = true
            }
            if ((chart_period & 8) > 0) {
                $("#cp_8")[0].checked = true
            }

            try {
                $("#csi_" + chart_swap_interval)[0].checked = true
            } catch (error) { }

            try {
                $("#cs_" + chart_style)[0].checked = true
            } catch (error) { }

            $("#heartbeat")[0].checked = (heartbeat !== 0)

            brightnessSlider.slider("setValue", settings['brightness'])
            console.log(JSON.stringify(settings))
        }

        function getSettings() {
            $.get("/settings.json", function (data) {
                displaySettings(data)
            })
        }

        function showError(text) {
            $("#error_text").empty().append("Error " + text)
            $('#error_modal').modal({})
            applyBusy(false)
        }

        function checkFailed(e) {
            showError(e.responseText)
        }

        function clickApply() {
            applyBusy(true)

            if (!$("#coin").val().match(/^[a-zA-Z0-9-]+$/)) {
                showError(": Coin ID '" + $("#coin").val() + "' is invalid!")
                return
            }
            if (!$("#currency").val().match(/^[a-zA-Z0-9]+$/)) {
                showError(": Currency value '" + $("#currency").val() + "' is invalid!")
                return
            }
            if (!$("#currency2").val().match(/^[a-zA-Z0-9]*$/)) {
                showError(": 2nd currency value '" + $("#currency2").val() + "' is invalid!")
                return
            }
            number_format = -1
            if ($("#nf_0")[0].checked) {
                number_format = 0
            } else if ($("#nf_1")[0].checked) {
                number_format = 1
            } else if ($("#nf_2")[0].checked) {
                number_format = 2
            } else if ($("#nf_3")[0].checked) {
                number_format = 3
            } else if ($("#nf_4")[0].checked) {
                number_format = 4
            } else if ($("#nf_5")[0].checked) {
                number_format = 5
            }
            if (number_format === -1) {
                showError(": Number format not selected!")
                return
            }

            chart_period = 0
            if ($("#cp_1")[0].checked) {
                chart_period += 1
            }
            if ($("#cp_2")[0].checked) {
                chart_period += 2
            }
            if ($("#cp_4")[0].checked) {
                chart_period += 4
            }
            if ($("#cp_8")[0].checked) {
                chart_period += 8
            }
            if (chart_period === 0) {
                showError(": No chart period selected!")
                return
            }

            chart_swap_interval = -1
            if ($("#csi_0")[0].checked) {
                chart_swap_interval = 0
            } else if ($("#csi_1")[0].checked) {
                chart_swap_interval = 1
            } else if ($("#csi_2")[0].checked) {
                chart_swap_interval = 2
            } else if ($("#csi_3")[0].checked) {
                chart_swap_interval = 3
            }
            if (chart_swap_interval === -1) {
                showError(": No chart swap interval selected!")
                return
            }

            chart_style = -1
            if ($("#cs_0")[0].checked) {
                chart_style = 0
            } else if ($("#cs_1")[0].checked) {
                chart_style = 1
            } else if ($("#cs_2")[0].checked) {
                chart_style = 2
            }
            if (chart_style === -1) {
                showError(": No chart style selected!")
                return
            }

            heartbeat = 0
            if ($("#heartbeat")[0].checked) {
                heartbeat = 1
            }

            $.get("/action/set?coin=" + $("#coin").val()
                + "&currency=" + $("#currency").val()
                + "&currency2=" + $("#currency2").val()
                + "&number_format=" + number_format
                + "&chart_period=" + chart_period
                + "&chart_swap_interval=" + chart_swap_interval
                + "&chart_style=" + chart_style
                + "&heartbeat=" + heartbeat, function (data) {

                    if (data["error"]) {
                        showError(": " + data["error"])
                    } else {
                        displaySettings(data)
                    }

                })
                .fail(checkFailed)
                .always(function () {
                    setTimeout(function () {
                        applyBusy(false)
                    }, 10000)
                })
        }

        $(document).ready(function () {

            brightnessSlider = $("#brightness").slider({
                min: 10, max: 255, value: 255, step: 50, tooltip: 'hide'
            })

            getSettings()

            brightnessSlider.on('change', function (e) {
                console.log(e.value.newValue)
                $.get("/action/set?brightness=" + e.value.newValue, function (data) {
                    console.log(data)
                })
            })

            $('#apply').off().click(clickApply)

            $(".enterapply").off().on('keyup', function (e) {
                if (event.keyCode === 13) {
                    event.preventDefault()
                    clickApply()
                }
            })

            $(".clearbutton").off().click(function (e) {
                clearId = '#' + e.target.id.replace('clear', '')
                $(clearId).val('')
                $(clearId).focus()
            })

        })

    </script>
</body>

</html>
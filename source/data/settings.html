<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <title>CoinTicker Settings</title>
</head>

<body>

    <div class="jumbotron jumbotron-fluid">
        <div class="container">
            <h1 class="display-4">CoinTicker</h1>
            <p class="lead">Settings</p>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="error_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title " id="error_modalLabel">Error occurred</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body text-danger">
                    <span id="error_text"></span>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid text-center">
        <div class="row content">
            <div class="col-sm-2 sidenav">
            </div>
            <div class="col-sm-7 text-left">
                <form>
                    <div class="form-group">
                        <label for="coin">Coin Gecko ID (e.g. bitcoin, ethereum)</label>
                        <input type="email" class="form-control" id="coin" placeholder="Coin Gecko ID">
                        <small id="emailHelp" class="form-text text-muted">Any valid coin id on coin gecko.</small>
                    </div>

                    <div class="form-group">
                        <label for="currency">Currency (e.g. USD, EUR)</label>
                        <input type="email" class="form-control" id="currency" placeholder="Currency">
                        <small id="emailHelp" class="form-text text-muted">Any valid vs. currency on coin
                            gecko.</small>
                    </div>

                    <div class="form-group">
                        <label>Number Format</label>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="number_format_options"
                                    id="number_format_0" value="0">
                                <label class="form-check-label" for="number_format_0">1.000,00</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="number_format_options"
                                    id="number_format_1" value="1">
                                <label class="form-check-label" for="number_format_1">1&#x2006;000,00</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="number_format_options"
                                    id="number_format_2" value="2">
                                <label class="form-check-label" for="number_format_2">1000,00</label>
                            </div>
                        </div>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="number_format_options"
                                    id="number_format_3" value="3">
                                <label class="form-check-label" for="number_format_3">1,000.00</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="number_format_options"
                                    id="number_format_4" value="4">
                                <label class="form-check-label" for="number_format4">1&#x2006;000.00</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="number_format_options"
                                    id="number_format_5" value="5">
                                <label class="form-check-label" for="number_format5">1000.00</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <button type="button" class="btn btn-success mb-2" id="apply">Apply</button>
                        <small id="emailHelp" class="form-text text-muted">Apply Settings.</small>
                    </div>

                </form>
            </div>
            <div class="col-sm-3 sidenav">
            </div>
        </div>
    </div>

    <footer class="footer bg-dark text-light ">
        <div class="container">
            &copy; 2020 barn53 &mdash; <a href="about.html">About</a>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>

    <script type="text/javascript">

        function actionGet(action) {
            $.get("/action/get/" + action, function (data) {
                $("#" + action).val(data)
                try {
                    $("#" + action + "_" + data)[0].checked = true
                } catch (error) {
                }
            })
        }

        function showError(text) {
            $("#error_text").empty().append("Error " + text)
            $('#error_modal').modal({})
        }

        function checkFailed(e) {
            $("#apply").prop("disabled", false)
            showError(e.responseText)
        }

        $(document).ready(function () {

            actionGet("coin")
            actionGet("currency")
            actionGet("number_format")

            $('#apply').off().click(function (e) {
                $("#apply").prop("disabled", true)

                if (!$("#coin").val().match(/^[a-zA-Z0-9-]+$/)) {
                    showError(": Coin ID '" + $("#coin").val() + "' is invalid!")
                    $("#apply").prop("disabled", false)
                    return
                }
                if (!$("#currency").val().match(/^[a-zA-Z0-9-]+$/)) {
                    showError(": Currency value '" + $("#currency").val() + "' is invalid!")
                    $("#apply").prop("disabled", false)
                    return
                }
                number_format = -1
                if ($("#number_format_0")[0].checked) {
                    number_format = 0
                } else if ($("#number_format_1")[0].checked) {
                    number_format = 1
                } else if ($("#number_format_2")[0].checked) {
                    number_format = 2
                } else if ($("#number_format_3")[0].checked) {
                    number_format = 3
                } else if ($("#number_format_4")[0].checked) {
                    number_format = 4
                } else if ($("#number_format_5")[0].checked) {
                    number_format = 5
                }
                if (number_format === -1) {
                    showError(": Number format is not selected!")
                    $("#apply").prop("disabled", false)
                    return
                }

                $.get("/action/set?coin=" + $("#coin").val() + "&currency=" + $("#currency").val() + "&number_format=" + number_format, function (data) {

                    $("#apply").prop("disabled", false)

                    if (data === "1") {
                        // actionGet("coin")
                        // actionGet("currency")
                        // actionGet("number_format")
                    } else {
                        showError(": " + data)
                    }

                })
                    .fail(checkFailed)
                    .always(function () {
                        setTimeout(function () {
                            $("#apply").prop("disabled", false)
                        }, 10000)
                    })
            })
        })

    </script>
</body>

</html>